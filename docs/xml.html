<!-- Generated at compile-time by MiscTools Builder on 2025-12-24T10:29:12.870Z -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="/favicon.png" type="image/png">
    <title>Deltamod MiscTools - Create Deltamod XML file</title>
    <link rel="stylesheet" href="xml.css">
    <link rel="manifest" href="./manifest.json">
</head>
<body>
    <div class="header">
        <h1 id="h1title">Create Deltamod XML file</h1>
        <p style="margin-bottom: 0;" id="h1desc">Create a modding.xml file for use in Deltamod</p>
    </div>
    <div class="main" style="height: calc(100% - 80px); overflow-y: scroll;">
        <b>Generate a <code>modding.xml</code> file</b>
<br><br>
<i>Before proceeding with making a modding.xml, we ask you to read the Deltamod Modding Standard</i>
<br>
<hr>
<table>
    <colgroup>
        <col style="width: 15%;">
        <col style="width: 40%;">
        <col style="width: 40%;">
        <col style="width: 5%;">
    </colgroup>
    <thead>
        <tr>
            <th>Patch type (XDelta, Override..)</th>
            <th>Patch file (ex. <code>./myModpackPatch.xdelta</code>)</th>
            <th>Patch destination (ex. <code>./chapter1_windows/data.win</code>)</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody id="patchBody">
        <!-- Rows will be added here dynamically -->
    </tbody>
    <tfoot>
        <tr>
            <td colspan="4"><button style="width: 100%; padding: 10px; font-size: 1em; cursor: pointer;" onclick="addPatch()">Add</button></td>
        </tr>
    </tfoot>
    </table>
<hr>
<button onclick="generateXML()">Generate <code>modding.xml</code> file</button>
    </div>
</body>
<!-- service worker -->
<script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker
                .register('/worker.js')
                .then((registration) => {
                    console.log('Service Worker registered with scope: ', registration.scope);
                })
                .catch((error) => {
                    console.log('Service Worker registration failed: ', error);
                });
        });
    }

</script>
<script>
    var cachedpatches = [];

function addPatch() {
    var uid = Date.now().toString() + Math.floor(Math.random() * 1000).toString();

    var tbody = document.getElementById('patchBody');
    var newRow = document.createElement('tr');
    
    var td0 = document.createElement('td');
    var select0 = document.createElement('select');
    select0.name = 'patchtype';
    select0.innerHTML = '<option value="xdelta">XDelta (or other supported patching file)</option><option value="override">Copy file to</option>';
    td0.appendChild(select0);

    var td1 = document.createElement('td');
    var input1 = document.createElement('input');
    input1.type = 'text';
    input1.name = 'patchfrom';
    input1.placeholder = './path/to/patch.xdelta';
    td1.appendChild(input1);

    var td2 = document.createElement('td');
    var input2 = document.createElement('input');
    input2.type = 'text';
    input2.name = 'patchto';
    input2.placeholder = './path/to/dest.win';
    td2.appendChild(input2);

    var td3 = document.createElement('td');
    var removeButton = document.createElement('button');
    removeButton.type = 'button';
    removeButton.style.width = '100%';
    removeButton.style.padding = '5px';
    removeButton.innerText = 'Remove';
    removeButton.onclick = function() {
        tbody.removeChild(newRow);
        cachedpatches = cachedpatches.filter(item => item.uid !== uid);
    };
    td3.appendChild(removeButton);

    cachedpatches.push({from: input1, to: input2, uid: uid});

    newRow.appendChild(td0);
    newRow.appendChild(td1);
    newRow.appendChild(td2);
    newRow.appendChild(td3);
    tbody.appendChild(newRow);
}

function generateXML() {
    function i(id) {
        return document.getElementById(id).value;
    }

    var str = "";

    var doc = document.implementation.createDocument("", "", null);

    cachedpatches.forEach(function (entry) {
        var fromInput = entry.from;
        var toInput = entry.to;
        if (!fromInput || !toInput) return;

        var row = fromInput.closest('tr');
        var typeSelect = row ? row.querySelector('select[name="patchtype"]') : null;
        var typeVal = typeSelect ? typeSelect.value : 'xdelta';

        var fromVal = fromInput.value.trim();
        var toVal = toInput.value.trim();
        if (!fromVal || !toVal) return;

        var patchEl = doc.createElement('patch');
        patchEl.setAttribute('type', typeVal);
        patchEl.setAttribute('patch', fromVal);
        patchEl.setAttribute('to', toVal);
        
        var patchString = new XMLSerializer().serializeToString(patchEl);
        str += patchString + "\n";
    });

    var blob = new Blob([str], { type: 'application/xml' });
    var url = URL.createObjectURL(blob);
    var a = document.createElement('a');
    a.href = url;
    a.download = 'modding.xml';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}
</script>
</html>